<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Speed AudioReader</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body data-theme="dark">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Library View ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="libraryView" class="library-view">
  <div class="library-header">
    <h1 class="library-title">Speed AudioReader</h1>
    <p class="library-subtitle">Select a book to start reading</p>
  </div>
  <div id="libraryGrid" class="library-grid">
    <!-- Book cards inserted by JS -->
  </div>
  <div id="libraryEmpty" class="library-empty" style="display:none">
    <p>No books found.</p>
    <p class="library-hint">
      Add a book to the <code>books/</code> directory and run:<br>
      <code>python preprocess.py books/your-book</code><br>
      <code>python map_chapters.py books/your-book</code>
    </p>
  </div>
  <div id="libraryLoading" class="library-loading">
    <div class="spinner"></div>
    <p>Scanning library...</p>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê Reader View ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="readerView" class="reader-view" style="display:none">
<canvas id="stage"></canvas>

<!-- Progress / Waveform bar -->
<div class="progressWrap">
  <div class="progressTopRow">
    <span id="currentTime">0:00</span>
    <span id="bookTitle" class="book-title">Loading...</span>
    <span id="timeLeft">0:00</span>
  </div>
  <div class="progressBarWrap">
    <div class="progressBar" id="progressBar" role="slider"
         aria-label="Progress" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" tabindex="0">
      <div id="progressFill" class="progressFill" style="width:0%"></div>
      <div id="chapterMarkers" class="chapter-markers"></div>
      <div id="bookmarkMarkers" class="bookmark-markers"></div>
    </div>
  </div>
  <div class="progressBottomRow">
    <span id="wordCounter" class="word-counter"></span>
    <span id="chapterName" class="chapter-name" title=""></span>
    <span id="statusMsg" class="status-msg"></span>
  </div>
</div>

<!-- Controls -->
<div class="controls">
  <div class="playbackRow">
    <button id="libraryBtn" class="icon-btn" title="Back to Library (Esc)" aria-label="Library">üìö</button>
    <button id="chaptersBtn" class="icon-btn chapters-btn" title="Chapters (L)" aria-label="Chapters" style="display:none">‚ò∞</button>
    <button id="prevChapterBtn" class="icon-btn" aria-label="Previous chapter" title="Prev chapter (P)" style="display:none">‚èÆ</button>
    <button id="resetBtn" class="icon-btn" aria-label="Reset to beginning" title="Reset">‚ü≤</button>
    <button id="back10Btn" class="icon-btn" aria-label="Back 10 seconds" title="-10s">‚è™</button>
    <button id="playBtn" class="playBtn icon-btn" aria-label="Play/Pause">
      <span id="playIcon" aria-hidden="true">‚ñ∂</span>
      <span id="pauseIcon" aria-hidden="true" hidden>‚è∏</span>
    </button>
    <button id="fwd10Btn" class="icon-btn" aria-label="Forward 10 seconds" title="+10s">‚è©</button>
    <button id="nextChapterBtn" class="icon-btn" aria-label="Next chapter" title="Next chapter (N)" style="display:none">‚è≠</button>
    <button id="bookmarkBtn" class="icon-btn bookmark-btn" title="Add bookmark (B)" aria-label="Add bookmark">üîñ</button>
    <button id="bookmarksListBtn" class="icon-btn" title="Bookmarks (Shift+B)" aria-label="Bookmarks list">üìë</button>
    <button id="settingsBtn" class="icon-btn settings-btn" title="Settings" aria-label="Settings">‚öô</button>
  </div>

  <div class="speedRow">
    <label for="speedRange" class="speed-label">Speed:</label>
    <button id="speedDown" class="icon-btn small-btn" aria-label="Decrease speed">‚àí</button>
    <input id="speedRange" type="range" min="0.25" max="3.0" step="0.05" value="1.0">
    <button id="speedUp" class="icon-btn small-btn" aria-label="Increase speed">+</button>
    <span id="speedLabel" class="speed-value">1.0√ó</span>
  </div>

  <div class="volumeRow">
    <label class="speed-label">Vol:</label>
    <input id="volumeRange" type="range" min="0" max="1" step="0.05" value="1.0">
    <span id="volumeLabel" class="speed-value">100%</span>
  </div>
</div>
</div><!-- /readerView -->

<!-- Settings Modal -->
<div id="settingsBackdrop" class="modal-backdrop">
  <div class="modal">
    <button class="modalCloseX" id="closeSettings" aria-label="Close settings">√ó</button>
    <strong>Settings</strong>

    <div class="themeGrid">
      <div class="themeRow">
        <label for="bgColor">Background</label>
        <div style="display:flex;gap:10px;align-items:center;">
          <input id="bgColor" type="color" value="#000000">
          <input id="bgHex" type="text" placeholder="#000000" class="hex-input">
        </div>
      </div>
      <div class="themeRow">
        <label for="fgColor">Text</label>
        <div style="display:flex;gap:10px;align-items:center;">
          <input id="fgColor" type="color" value="#ffffff">
          <input id="fgHex" type="text" placeholder="#ffffff" class="hex-input">
        </div>
      </div>
      <div class="themeRow">
        <label for="focusColor">Focus letter</label>
        <div style="display:flex;gap:10px;align-items:center;">
          <input id="focusColor" type="color" value="#ff2a2a">
          <input id="focusHex" type="text" placeholder="#ff2a2a" class="hex-input">
        </div>
      </div>
      <div class="themeRow">
        <label for="fontScaleRange">Font scale</label>
        <div style="display:flex;gap:10px;align-items:center;">
          <input id="fontScaleRange" type="range" min="0.25" max="3.00" step="0.05" value="1.0">
          <span id="fontScaleLabel">1.0</span>
        </div>
      </div>
      <div class="themeRow">
        <label for="contextToggle">Show context</label>
        <button id="contextToggle" class="toggle-btn">Off</button>
      </div>
    </div>

    <div class="modalRow">
      <button id="themeResetBtn">Reset</button>
      <button id="themeApplyBtn">Apply</button>
    </div>
  </div>
</div>

<!-- Chapters Modal -->
<div id="chaptersBackdrop" class="modal-backdrop">
  <div class="modal chapters-modal">
    <button class="modalCloseX" id="closeChapters" aria-label="Close chapters">√ó</button>
    <strong>Chapters</strong>
    <ul id="chapterList" class="chapter-list"></ul>
  </div>
</div>

<!-- Bookmarks Modal -->
<div id="bookmarksBackdrop" class="modal-backdrop">
  <div class="modal bookmarks-modal">
    <button class="modalCloseX" id="closeBookmarks" aria-label="Close bookmarks">√ó</button>
    <strong>Bookmarks</strong>
    <ul id="bookmarkList" class="bookmark-list"></ul>
    <div class="bookmark-empty" id="bookmarkEmpty">
      <p>No bookmarks yet.</p>
      <p class="bookmark-hint">Press <kbd>B</kbd> while reading to add one.</p>
    </div>
  </div>
</div>

<!-- Bookmark Name Input Modal -->
<div id="bookmarkNameBackdrop" class="modal-backdrop">
  <div class="modal bookmark-name-modal">
    <button class="modalCloseX" id="closeBookmarkName" aria-label="Cancel">√ó</button>
    <strong>Name this bookmark</strong>
    <div class="bookmark-name-preview" id="bookmarkNamePreview"></div>
    <input type="text" id="bookmarkNameInput" class="bookmark-name-input" placeholder="e.g. Favourite passage, Left off here..." maxlength="80" autocomplete="off">
    <div class="modalRow">
      <button id="bookmarkNameCancel">Cancel</button>
      <button id="bookmarkNameSave">Save</button>
    </div>
  </div>
</div>

<!-- Loading overlay (used when loading a book in reader view) -->
<div id="loadingOverlay" class="loading-overlay hidden">
  <div class="loading-content">
    <div class="spinner"></div>
    <p id="loadingText">Loading alignment data...</p>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>
